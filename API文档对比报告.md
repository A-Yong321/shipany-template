# API æ–‡æ¡£å‡†ç¡®æ€§å¯¹æ¯”æŠ¥å‘Š

> **ç”¨é€”**: ç”¨äºå‘äº§å“ç»ç†åé¦ˆæ–‡æ¡£ä¸å‡†ç¡®ä¹‹å¤„  
> **ç”Ÿæˆæ—¶é—´**: 2026-02-10  
> **éªŒè¯èŒƒå›´**: å›¾ç‰‡ç”Ÿæˆã€è§†é¢‘ç”Ÿæˆã€ä»»åŠ¡æŸ¥è¯¢ã€è´¦æˆ·ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ 

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

ç»è¿‡å…¨é¢éªŒè¯,**APIå¯¹æ¥æ–‡æ¡£(1).md å­˜åœ¨ç³»ç»Ÿæ€§æ ¼å¼é”™è¯¯**:

- âŒ **æ‰€æœ‰æ¥å£**çš„å“åº”æ ¼å¼æè¿°å‡ä¸å‡†ç¡®
- âŒ **å›¾ç‰‡ç”Ÿæˆ**ç¼ºå°‘å¿…éœ€çš„ `action` å‚æ•°è¯´æ˜
- âœ… **è´¦æˆ·ä½™é¢æŸ¥è¯¢**æ ¼å¼åŸºæœ¬å‡†ç¡®(ä»… `tier` å­—æ®µç±»å‹ä¸åŒ)
- âœ… **è¯·æ±‚æ ¼å¼**å¤§éƒ¨åˆ†å‡†ç¡®

**å½±å“**: æŒ‰æ–‡æ¡£ç¼–å†™çš„ä»£ç å°† 100% æ— æ³•æ­£å¸¸å·¥ä½œ

---

## ğŸ” è¯¦ç»†å¯¹æ¯”

### 1. å›¾ç‰‡ç”Ÿæˆ API

#### âŒ é—®é¢˜ 1: ç¼ºå°‘å¿…éœ€å‚æ•°

**æ–‡æ¡£æè¿°** (ç¬¬ 132-140 è¡Œ):
```json
{
  "prompt": "a beautiful sunset over the ocean",
  "model": "flux-dev",
  "size": "1024x1024",
  "count": 1
}
```

**å®é™…è¦æ±‚**:
```json
{
  "action": "generate",  // âŒ å¿…éœ€!æ–‡æ¡£æœªæåŠ
  "prompt": "...",
  "model": "flux-dev",
  "size": "1024x1024",
  "count": 1
}
```

**éªŒè¯è¯æ®**: ç¼ºå°‘ `action` å‚æ•°ä¼šè¿”å› 400 é”™è¯¯

---

#### âŒ é—®é¢˜ 2: å“åº”æ ¼å¼å®Œå…¨é”™è¯¯

**æ–‡æ¡£å£°ç§°** (ç¬¬ 332-346 è¡Œ):
```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "succeeded",
  "images": [
    {"url": "https://cdn.example.com/image1.png"}
  ]
}
```

**å®é™…å“åº”**:
```json
{
  "id": "019c478e-5d47-7e6b-93d1-e13f26257652",
  "type": "images",
  "created_at": 1770727038.279,
  "finished_at": 1770727501.717,
  "request": {...},
  "response": {
    "success": true,
    "task_id": "...",
    "data": {
      "imageUrls": [
        "https://yly-1252838868.file.myqcloud.com/.../xxx.jpg"
      ]
    }
  }
}
```

**å·®å¼‚å¯¹æ¯”**:

| å­—æ®µ | æ–‡æ¡£ | å®é™… | å·®å¼‚ |
|------|------|------|------|
| é¡¶å±‚ `status` | âœ… å­˜åœ¨ | âŒ ä¸å­˜åœ¨ | **å®Œå…¨ä¸åŒ** |
| é¡¶å±‚ `images` | âœ… å­˜åœ¨ | âŒ ä¸å­˜åœ¨ | **å®Œå…¨ä¸åŒ** |
| `response` å¯¹è±¡ | âŒ ä¸å­˜åœ¨ | âœ… å­˜åœ¨ | **å®Œå…¨ä¸åŒ** |
| `response.success` | âŒ ä¸å­˜åœ¨ | âœ… æˆåŠŸæ ‡å¿— | **å®Œå…¨ä¸åŒ** |
| `response.data.imageUrls` | âŒ ä¸å­˜åœ¨ | âœ… å›¾ç‰‡æ•°ç»„ | **å®Œå…¨ä¸åŒ** |

---

### 2. è§†é¢‘ç”Ÿæˆ API

#### âœ… è¯·æ±‚æ ¼å¼å‡†ç¡®

**æ–‡æ¡£æè¿°** (ç¬¬ 182-189 è¡Œ):
```json
{
  "action": "text2video",
  "prompt": "a cat playing with a ball in the garden",
  "model": "kling-v1",
  "duration": 5,
  "aspect_ratio": "16:9"
}
```

**å®é™…æµ‹è¯•**: âœ… è¯·æ±‚æˆåŠŸ,æ ¼å¼æ­£ç¡®

---

#### âŒ å“åº”æ ¼å¼é”™è¯¯

**æ–‡æ¡£å£°ç§°** (ç¬¬ 220-224 è¡Œ):
```json
{
  "task_id": "dd01fc69-e1f7-4b68-aa8c-463f6b748d11"
}
```

**å®é™…å“åº”**:
```json
{
  "success": true,
  "task_id": "019c47ba-bbb6-7b30-b81d-26dfaa06fa52",
  "trace_id": "9ec72334df4e835737e3b1b14c985fa6",
  "data": []
}
```

**å·®å¼‚**: æ–‡æ¡£æœªæåŠ `success`ã€`trace_id`ã€`data` å­—æ®µ

---

### 3. ä»»åŠ¡æŸ¥è¯¢ API

#### âŒ å“åº”æ ¼å¼é”™è¯¯(å¤„ç†ä¸­çŠ¶æ€)

**æ–‡æ¡£å£°ç§°** (ç¬¬ 324-330 è¡Œ):
```json
{
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "processing",
  "created_at": "2026-01-24T10:30:00+08:00"
}
```

**å®é™…å“åº”** (Grok å¹³å°):
```json
{
  "id": "019c47af-5ff0-7263-a95e-690444747c74",
  "trace_id": "...",
  "type": "images",
  "created_at": 1770729201.648,
  "request": {...},
  "response": {
    "task_id": "...",
    "trace_id": "..."
  }
}
```

**å·®å¼‚**: 
- âŒ æ²¡æœ‰é¡¶å±‚ `status` å­—æ®µ
- âŒ æ—¶é—´æ ¼å¼ä¸åŒ(Unix æ—¶é—´æˆ³ vs ISO 8601)
- âœ… æœ‰ `response` åµŒå¥—å¯¹è±¡

---

#### âŒ å“åº”æ ¼å¼é”™è¯¯(æˆåŠŸçŠ¶æ€)

**æ–‡æ¡£å£°ç§°** (ç¬¬ 348-361 è¡Œ):
```json
{
  "task_id": "dd01fc69-e1f7-4b68-aa8c-463f6b748d11",
  "status": "succeeded",
  "video": {
    "url": "https://cdn.example.com/video.mp4",
    "duration": 5
  }
}
```

**å®é™…å“åº”** (åŸºäºå›¾ç‰‡ç”Ÿæˆæ¨æ–­):
```json
{
  "id": "...",
  "response": {
    "success": true,
    "data": {
      "videoUrl": "https://..."  // æˆ– videoUrls
    }
  }
}
```

**å·®å¼‚**: å®Œå…¨ä¸åŒçš„åµŒå¥—ç»“æ„

---

### 4. è´¦æˆ·ç®¡ç† API

#### âœ… ä½™é¢æŸ¥è¯¢æ ¼å¼åŸºæœ¬å‡†ç¡®

**æ–‡æ¡£æè¿°** (ç¬¬ 433-453 è¡Œ):
```json
{
  "success": true,
  "data": [{
    "balance_cents": 100000,
    "balance_display": "Â¥1000.00",
    "tier": 2,
    "tier_name": "æ ‡å‡†ç‰ˆ",
    ...
  }],
  "trace_id": "abc123def456"
}
```

**å®é™…å“åº”**:
```json
{
  "success": true,
  "trace_id": "a8ab969312c565d608f7de2a71c3ec98",
  "data": [{
    "usage_today": {...},
    "balance_display": "Â¥995.00",
    "tier_name": "æ ‡å‡†ç‰ˆ",
    "rate_limit": {...},
    "tier": "standard",  // âš ï¸ å­—ç¬¦ä¸²è€Œéæ•°å­—
    "balance_cents": 99500
  }]
}
```

**å·®å¼‚**: 
- âš ï¸ `tier` å­—æ®µç±»å‹ä¸åŒ(æ–‡æ¡£è¯´ `int`,å®é™…æ˜¯ `string`)
- âœ… å…¶ä»–å­—æ®µåŸºæœ¬ä¸€è‡´

---

### 5. æ–‡ä»¶ä¸Šä¼  API

#### âœ… è¯·æ±‚æ ¼å¼å‡†ç¡®

**æ–‡æ¡£æè¿°** (ç¬¬ 537-548 è¡Œ): `multipart/form-data` æ ¼å¼

**å®é™…æµ‹è¯•**: âœ… ä¸Šä¼ æˆåŠŸ

---

#### âŒ å“åº”æ ¼å¼é”™è¯¯

**æ–‡æ¡£å£°ç§°** (ç¬¬ 556-569 è¡Œ):
```json
{
  "success": true,
  "data": [{
    "url": "https://cdn.example.com/uploads/abc123.jpg",
    "filename": "image.jpg",
    "size": 1024000,
    "content_type": "image/jpeg"
  }],
  "trace_id": "xyz789"
}
```

**å®é™…å“åº”**:
```json
{
  "success": true,
  "trace_id": "6fad92f7b2c4db3498513ec2fc3ca2de",
  "data": [{
    "url": "https://yly-1252838868.file.myqcloud.com/.../xxx.jpg",
    "key": "openapi/20260210/null/xxx.jpg"
  }]
}
```

**å·®å¼‚**:
- âŒ ç¼ºå°‘ `filename`ã€`size`ã€`content_type` å­—æ®µ
- âœ… æœ‰ `key` å­—æ®µ(æ–‡æ¡£æœªæåŠ)

---

## ğŸ“Š é—®é¢˜æ±‡æ€»

### ç³»ç»Ÿæ€§é—®é¢˜

1. **å“åº”æ ¼å¼ä¸ç»Ÿä¸€**: æ–‡æ¡£æè¿°çš„æ˜¯"æ ‡å‡†åŒ–"æ ¼å¼,ä½†å®é™… API ä½¿ç”¨å¹³å°ç‰¹å®šæ ¼å¼
2. **Grok å¹³å°ç‰¹æ®Šæ€§**: ä½¿ç”¨åµŒå¥—çš„ `response.data` ç»“æ„,ä¸æ–‡æ¡£å®Œå…¨ä¸åŒ
3. **æˆåŠŸæ ‡å¿—ä¸ä¸€è‡´**: Grok ç”¨ `response.success`,æ–‡æ¡£ç”¨ `status`

### æŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç±»

| ä¸¥é‡ç¨‹åº¦ | æ¥å£ | é—®é¢˜ |
|---------|------|------|
| ğŸ”´ ä¸¥é‡ | å›¾ç‰‡ç”Ÿæˆ | ç¼ºå°‘å¿…éœ€å‚æ•° + å“åº”æ ¼å¼å®Œå…¨é”™è¯¯ |
| ğŸ”´ ä¸¥é‡ | ä»»åŠ¡æŸ¥è¯¢ | å“åº”æ ¼å¼å®Œå…¨é”™è¯¯(Grok) |
| ğŸŸ¡ ä¸­ç­‰ | è§†é¢‘ç”Ÿæˆ | å“åº”æ ¼å¼éƒ¨åˆ†é”™è¯¯ |
| ğŸŸ¡ ä¸­ç­‰ | æ–‡ä»¶ä¸Šä¼  | å“åº”å­—æ®µä¸å®Œæ•´ |
| ğŸŸ¢ è½»å¾® | è´¦æˆ·ä½™é¢ | å­—æ®µç±»å‹ä¸ä¸€è‡´ |

---

## ğŸ’¡ å»ºè®®

### ç»™æ–‡æ¡£ç»´æŠ¤è€…

1. **åŒºåˆ†å¹³å°å·®å¼‚**: æ˜ç¡®è¯´æ˜ä¸åŒå¹³å°(Grok/Kling/Dreamina)çš„å“åº”æ ¼å¼å·®å¼‚
2. **è¡¥å……å¿…éœ€å‚æ•°**: åœ¨å›¾ç‰‡ç”Ÿæˆç¤ºä¾‹ä¸­æ·»åŠ  `action: 'generate'`
3. **æä¾›çœŸå®ç¤ºä¾‹**: ä½¿ç”¨å®é™… API å“åº”ä½œä¸ºæ–‡æ¡£ç¤ºä¾‹,è€Œéç†æƒ³åŒ–æ ¼å¼
4. **ç»Ÿä¸€å“åº”åŒ…è£…**: è€ƒè™‘åœ¨ API ç½‘å…³å±‚ç»Ÿä¸€å“åº”æ ¼å¼

### ç»™å¼€å‘è€…

1. **ä¸è¦ç›´æ¥ä¾èµ–æ–‡æ¡£**: å¿…é¡»è¿›è¡Œå®é™…æµ‹è¯•
2. **ä½¿ç”¨æŠ½è±¡å±‚**: é€šè¿‡ Provider æ¨¡å¼å°è£…å¹³å°å·®å¼‚
3. **å‚è€ƒæœ¬é¡¹ç›®å®ç°**: `src/extensions/ai/aistudio.ts` å·²æ­£ç¡®å¤„ç†æ‰€æœ‰å·®å¼‚

---

## ğŸ“ éªŒè¯æ–¹æ³•

æœ¬æ¬¡éªŒè¯ä½¿ç”¨çš„è„šæœ¬:
- `scripts/verify_grok_api_v2.py`: å›¾ç‰‡ç”Ÿæˆå®Œæ•´éªŒè¯
- `scripts/verify_all_apis.py`: å…¶ä»–æ¥å£ç»¼åˆéªŒè¯

è¿è¡Œæ–¹å¼:
```bash
python scripts/verify_all_apis.py
```

---

## âœ… ç»“è®º

**APIå¯¹æ¥æ–‡æ¡£(1).md å­˜åœ¨ç³»ç»Ÿæ€§ä¸å‡†ç¡®é—®é¢˜**,ä¸»è¦ä½“ç°åœ¨:

1. âŒ **å“åº”æ ¼å¼æè¿°ä¸å®é™…å®Œå…¨ä¸åŒ**(å°¤å…¶æ˜¯ Grok å¹³å°)
2. âŒ **ç¼ºå°‘å…³é”®å‚æ•°è¯´æ˜**(å¦‚ `action`)
3. âš ï¸ **å­—æ®µç±»å‹ä¸ä¸€è‡´**(å¦‚ `tier`)

**å»ºè®®**: 
- äº§å“ç»ç†åº”è¦æ±‚ API æä¾›æ–¹æ›´æ–°æ–‡æ¡£æˆ–æä¾›å¹³å°å·®å¼‚è¯´æ˜
- å¼€å‘å›¢é˜Ÿåº”åŸºäºå®é™…æµ‹è¯•ç»“æœè€Œéæ–‡æ¡£è¿›è¡Œå¼€å‘
- æœ¬é¡¹ç›®å·²æ­£ç¡®å¤„ç†æ‰€æœ‰å·®å¼‚,å¯ä½œä¸ºå‚è€ƒå®ç°
