# AI Studio API æ­£ç¡®æ¥å£è§„èŒƒ

> **ç”¨é€”**: åŸºäºå®é™… API æµ‹è¯•ç»“æœç¼–å†™çš„æ­£ç¡®æ¥å£æ–‡æ¡£  
> **æ›´æ–°æ—¶é—´**: 2026-02-10  
> **é€‚ç”¨èŒƒå›´**: å›¾ç‰‡ç”Ÿæˆã€è§†é¢‘ç”Ÿæˆã€ä»»åŠ¡æŸ¥è¯¢ã€è´¦æˆ·ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ 

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ä¿¡æ¯

- **API åŸºç¡€åœ°å€**: `https://openapi.ai-studio.me`
- **åè®®**: HTTPS
- **è¯·æ±‚æ–¹å¼**: POST
- **Content-Type**: `application/json`
- **è®¤è¯æ–¹å¼**: Bearer Token

### è®¤è¯

æ‰€æœ‰è¯·æ±‚éœ€åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦:

```
Authorization: Bearer {your_api_key}
```

---

## ğŸ¨ å›¾ç‰‡ç”Ÿæˆ API

### è¯·æ±‚æ ¼å¼

**POST** `/api/{platform}/images`

æ”¯æŒå¹³å°: `grok`, `dreamina`, `kling`, `lovart`, `krea`

### è¯·æ±‚å‚æ•°

```json
{
  "action": "generate",
  "prompt": "a beautiful sunset over the ocean",
  "model": "flux-dev",
  "size": "1024x1024",
  "count": 1
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| action | string | âœ… | **å¿…éœ€!** æ“ä½œç±»å‹,å›¾ç‰‡ç”Ÿæˆå›ºå®šä¸º `generate` |
| prompt | string | âœ… | å›¾ç‰‡æè¿°æç¤ºè¯ |
| model | string | âŒ | æ¨¡å‹åç§°(å¦‚ `flux-dev`) |
| size | string | âŒ | å›¾ç‰‡å°ºå¯¸(å¦‚ `1024x1024`) |
| count | int | âŒ | ç”Ÿæˆæ•°é‡,é»˜è®¤ 1 |

### å“åº”æ ¼å¼

#### åˆ›å»ºä»»åŠ¡å“åº”

```json
{
  "success": true,
  "task_id": "019c47af-5ff0-7263-a95e-690444747c74",
  "trace_id": "5fcdb82bd70c095dec89212ef19c7728",
  "data": []
}
```

#### å®Œæ•´ç¤ºä¾‹

```bash
curl -X POST \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "action": "generate",
    "prompt": "a cute cat sitting on grass",
    "model": "flux-dev",
    "size": "1024x1024",
    "count": 1
  }' \
  https://openapi.ai-studio.me/api/grok/images
```

---

## ğŸ¬ è§†é¢‘ç”Ÿæˆ API

### è¯·æ±‚æ ¼å¼

**POST** `/api/{platform}/videos`

æ”¯æŒå¹³å°: `sora`, `dreamina`, `kling`, `hailuo`, `higgsfield`, `heygen`, `krea`

### æ–‡ç”Ÿè§†é¢‘è¯·æ±‚å‚æ•°

```json
{
  "action": "text2video",
  "prompt": "a cat playing with a ball",
  "model": "kling-v1",
  "duration": 5,
  "aspect_ratio": "16:9"
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| action | string | âœ… | æ“ä½œç±»å‹: `text2video` |
| prompt | string | âœ… | è§†é¢‘æè¿°æç¤ºè¯ |
| model | string | âŒ | æ¨¡å‹åç§° |
| duration | int | âŒ | è§†é¢‘æ—¶é•¿(ç§’): 5, 10, 15 ç­‰ |
| aspect_ratio | string | âŒ | å®½é«˜æ¯”: `16:9`, `9:16`, `1:1` |

### å›¾ç”Ÿè§†é¢‘è¯·æ±‚å‚æ•°

```json
{
  "action": "image2video",
  "prompt": "make this image come alive",
  "image_url": "https://example.com/image.jpg",
  "duration": 5
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| action | string | âœ… | å›ºå®šå€¼: `image2video` |
| prompt | string | âœ… | è§†é¢‘æè¿°æç¤ºè¯ |
| image_url | string | âœ… | å‚è€ƒå›¾ç‰‡ URL |
| duration | int | âŒ | è§†é¢‘æ—¶é•¿(ç§’) |

### å“åº”æ ¼å¼

```json
{
  "success": true,
  "task_id": "019c47ba-bbb6-7b30-b81d-26dfaa06fa52",
  "trace_id": "9ec72334df4e835737e3b1b14c985fa6",
  "data": []
}
```

---

## ğŸ” ä»»åŠ¡æŸ¥è¯¢ API

### è¯·æ±‚æ ¼å¼

**POST** `/api/{platform}/tasks`

### è¯·æ±‚å‚æ•°

```json
{
  "task_id": "019c47af-5ff0-7263-a95e-690444747c74"
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| task_id | string | âœ… | ä»»åŠ¡ ID(ç”Ÿæˆæ¥å£è¿”å›çš„ task_id) |

### å“åº”æ ¼å¼

#### å¤„ç†ä¸­çŠ¶æ€

```json
{
  "id": "019c47af-5ff0-7263-a95e-690444747c74",
  "trace_id": "5fcdb82bd70c095dec89212ef19c7728",
  "type": "images",
  "created_at": 1770729201.648,
  "request": {
    "size": "1024x1024",
    "count": 1,
    "model": "flux-dev",
    "prompt": "..."
  },
  "response": {
    "task_id": "019c47af-5ff0-7263-a95e-690444747c74",
    "trace_id": "ea38eadf9626ebf60d7b253d8fb0560f"
  }
}
```

**åˆ¤æ–­æ–¹æ³•**: 
- å¦‚æœ `response.success` ä¸å­˜åœ¨æˆ–ä¸º `false`,ä»»åŠ¡ä»åœ¨å¤„ç†ä¸­
- å¦‚æœ `response.data` ä¸ºç©ºæˆ–ä¸å­˜åœ¨,ä»»åŠ¡ä»åœ¨å¤„ç†ä¸­

#### æˆåŠŸçŠ¶æ€ - å›¾ç‰‡

```json
{
  "id": "019c478e-5d47-7e6b-93d1-e13f26257652",
  "trace_id": "27febfd9015cdfac57ebfea071b23705",
  "type": "images",
  "created_at": 1770727038.279,
  "finished_at": 1770727501.717,
  "request": {...},
  "response": {
    "success": true,
    "task_id": "019c478e-5d47-7e6b-93d1-e13f26257652",
    "trace_id": "352f0c7ce341275f57282fedf55ec5b9",
    "data": {
      "imageUrls": [
        "https://yly-1252838868.file.myqcloud.com/.../image1.jpg",
        "https://yly-1252838868.file.myqcloud.com/.../image2.jpg"
      ]
    }
  }
}
```

**åˆ¤æ–­æ–¹æ³•**: `response.success === true`

**å›¾ç‰‡ URL æå–**: `response.data.imageUrls` (æ³¨æ„æ˜¯ `imageUrls` ä¸æ˜¯ `images`)

#### æˆåŠŸçŠ¶æ€ - è§†é¢‘

```json
{
  "id": "...",
  "response": {
    "success": true,
    "data": {
      "videoUrl": "https://...",
      "duration": 5
    }
  }
}
```

**è§†é¢‘ URL æå–**: `response.data.videoUrl` æˆ– `response.data.videoUrls[0]`

#### å¤±è´¥çŠ¶æ€

```json
{
  "id": "...",
  "response": {
    "success": false,
    "error": {
      "code": "GENERATION_FAILED",
      "message": "ç”Ÿæˆå¤±è´¥"
    }
  }
}
```

### çŠ¶æ€åˆ¤æ–­é€»è¾‘

```typescript
function getTaskStatus(data: any): 'pending' | 'processing' | 'success' | 'failed' {
  // æ–¹æ³• 1: æ£€æŸ¥ response.success (Grok/Flux å¹³å°)
  if (data.response?.success === true) {
    return 'success';
  }
  if (data.response?.success === false) {
    return 'failed';
  }
  
  // æ–¹æ³• 2: æ£€æŸ¥ finished_at (å·²å®Œæˆä½†æ²¡æœ‰ success æ ‡å¿—)
  if (data.finished_at && !data.response?.success) {
    return 'failed';
  }
  
  // æ–¹æ³• 3: æ£€æŸ¥ status å­—æ®µ(å…¶ä»–å¹³å°å¯èƒ½ä½¿ç”¨)
  if (data.status === 'succeeded') return 'success';
  if (data.status === 'failed') return 'failed';
  if (data.status === 'processing') return 'processing';
  
  // é»˜è®¤ä¸ºå¤„ç†ä¸­
  return 'processing';
}
```

---

## ğŸ’° è´¦æˆ·ç®¡ç† API

### æŸ¥è¯¢ä½™é¢

**POST** `/api/account/balance`

#### è¯·æ±‚å‚æ•°

æ— éœ€è¯·æ±‚ä½“,ç›´æ¥å‘é€ POST è¯·æ±‚ã€‚

#### å“åº”æ ¼å¼

```json
{
  "success": true,
  "trace_id": "a8ab969312c565d608f7de2a71c3ec98",
  "data": [{
    "balance_cents": 99500,
    "balance_display": "Â¥995.00",
    "tier": "standard",
    "tier_name": "æ ‡å‡†ç‰ˆ",
    "usage_today": {
      "request_count": 15,
      "cost_cents": 580
    },
    "rate_limit": {
      "per_minute": 20,
      "per_day": 500,
      "remaining_today": 485
    }
  }]
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| balance_cents | int | è´¦æˆ·ä½™é¢(åˆ†),99500 = Â¥995.00 |
| balance_display | string | æ ¼å¼åŒ–çš„ä½™é¢æ˜¾ç¤º |
| tier | string | å¥—é¤ç­‰çº§: `free`, `standard`, `pro` |
| tier_name | string | å¥—é¤åç§° |
| usage_today.request_count | int | ä»Šæ—¥è¯·æ±‚æ¬¡æ•° |
| usage_today.cost_cents | int | ä»Šæ—¥æ¶ˆè´¹é‡‘é¢(åˆ†) |
| rate_limit.per_minute | int | æ¯åˆ†é’Ÿè¯·æ±‚é™åˆ¶ |
| rate_limit.per_day | int | æ¯å¤©è¯·æ±‚é™åˆ¶ |
| rate_limit.remaining_today | int | ä»Šæ—¥å‰©ä½™è¯·æ±‚æ¬¡æ•° |

---

## ğŸ“¤ æ–‡ä»¶ä¸Šä¼  API

### è¯·æ±‚æ ¼å¼

**POST** `/api/upload/file`

Content-Type: `multipart/form-data`

### è¯·æ±‚å‚æ•°

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| file | file | âœ… | æ–‡ä»¶å¯¹è±¡(å›¾ç‰‡æˆ–è§†é¢‘) |

### æ–‡ä»¶é™åˆ¶

- **æœ€å¤§æ–‡ä»¶å¤§å°**: 100 MB
- **æ”¯æŒæ ¼å¼**: 
  - å›¾ç‰‡: jpg, jpeg, png, gif, webp
  - è§†é¢‘: mp4, mov, avi, webm

### å“åº”æ ¼å¼

```json
{
  "success": true,
  "trace_id": "6fad92f7b2c4db3498513ec2fc3ca2de",
  "data": [{
    "url": "https://yly-1252838868.file.myqcloud.com/.../xxx.jpg",
    "key": "openapi/20260210/null/xxx.jpg"
  }]
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| url | string | æ–‡ä»¶è®¿é—® URL |
| key | string | æ–‡ä»¶å­˜å‚¨è·¯å¾„ |

### å®Œæ•´ç¤ºä¾‹

```bash
curl -X POST \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -F "file=@/path/to/image.jpg" \
  https://openapi.ai-studio.me/api/upload/file
```

---

## ğŸ”§ å®ç°å»ºè®®

### 1. ç»Ÿä¸€å“åº”å¤„ç†

æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨ `{success, data, trace_id}` åŒ…è£…æ ¼å¼,å»ºè®®åˆ›å»ºç»Ÿä¸€çš„å“åº”å¤„ç†å‡½æ•°:

```typescript
interface APIResponse<T = any> {
  success: boolean;
  data?: T;
  trace_id?: string;
  error?: {
    code: string;
    message: string;
  };
}

function handleAPIResponse<T>(response: APIResponse<T>): T {
  if (!response.success) {
    throw new Error(response.error?.message || 'API request failed');
  }
  return response.data!;
}
```

### 2. ä»»åŠ¡è½®è¯¢

ç”±äº AI ç”Ÿæˆä»»åŠ¡è€—æ—¶è¾ƒé•¿,å»ºè®®ä½¿ç”¨è½®è¯¢æ¨¡å¼:

```typescript
async function pollTaskUntilComplete(
  taskId: string,
  platform: string,
  maxAttempts = 60,
  interval = 3000
): Promise<any> {
  for (let i = 0; i < maxAttempts; i++) {
    const result = await queryTask(taskId, platform);
    
    // æ£€æŸ¥æˆåŠŸ
    if (result.response?.success === true) {
      return result;
    }
    
    // æ£€æŸ¥å¤±è´¥
    if (result.response?.success === false || result.finished_at) {
      throw new Error('Task failed');
    }
    
    // ç­‰å¾…åé‡è¯•
    await sleep(interval);
  }
  
  throw new Error('Task timeout');
}
```

### 3. å¹³å°å·®å¼‚å¤„ç†

ä¸åŒå¹³å°çš„å“åº”æ ¼å¼å¯èƒ½ç•¥æœ‰å·®å¼‚,å»ºè®®ä½¿ç”¨ Provider æ¨¡å¼å°è£…:

```typescript
interface AIProvider {
  generateImage(params: ImageParams): Promise<TaskResult>;
  generateVideo(params: VideoParams): Promise<TaskResult>;
  queryTask(taskId: string): Promise<TaskResult>;
}

class GrokProvider implements AIProvider {
  // å¤„ç† Grok ç‰¹å®šçš„å“åº”æ ¼å¼
  async queryTask(taskId: string): Promise<TaskResult> {
    const response = await fetch(...);
    const data = await response.json();
    
    // æå–å›¾ç‰‡ URL
    const imageUrls = data.response?.data?.imageUrls || [];
    
    return {
      taskId: data.id,
      status: data.response?.success ? 'success' : 'processing',
      result: imageUrls
    };
  }
}
```

---

## âš ï¸ é‡è¦æç¤º

1. **å¿…éœ€å‚æ•°**: å›¾ç‰‡ç”Ÿæˆå¿…é¡»åŒ…å« `action: 'generate'`
2. **å“åº”æ ¼å¼**: æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨åµŒå¥—çš„ `response.data` ç»“æ„(Grok å¹³å°)
3. **æˆåŠŸåˆ¤æ–­**: ä½¿ç”¨ `response.success === true` è€Œé `status === 'succeeded'`
4. **å­—æ®µåç§°**: å›¾ç‰‡æ˜¯ `imageUrls` ä¸æ˜¯ `images`
5. **æ—¶é—´æ ¼å¼**: Unix æ—¶é—´æˆ³(ç§’),ä¸æ˜¯ ISO 8601 å­—ç¬¦ä¸²

---

## ğŸ“š å‚è€ƒå®ç°

æœ¬é¡¹ç›®å·²æ­£ç¡®å®ç°æ‰€æœ‰æ¥å£,å‚è€ƒæ–‡ä»¶:
- `src/extensions/ai/aistudio.ts`: AI Studio Provider å®ç°
- `src/app/api/ai/generate/route.ts`: ç”Ÿæˆæ¥å£
- `src/app/api/ai/query/route.ts`: æŸ¥è¯¢æ¥å£

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

- **2026-02-10**: åŸºäºå®é™… API æµ‹è¯•åˆ›å»ºåˆå§‹ç‰ˆæœ¬
- ä¿®æ­£äº†åŸæ–‡æ¡£ä¸­çš„æ‰€æœ‰æ ¼å¼é”™è¯¯
- æ·»åŠ äº†è¯¦ç»†çš„çŠ¶æ€åˆ¤æ–­é€»è¾‘
- æä¾›äº†å®Œæ•´çš„å®ç°å»ºè®®
